!function(){function a(a,b,c,d,e,f){this.auth0Lib=a,this.$cookieStore=b,this.$rootScope=c,this.$safeApply=d,this.$q=e,this.urlBase64Decode=f,this.delegatedTokens={},this.profile={}}function b(a,b,c){c?a.put(b,c):a.remove(b)}var c=angular.module("util",[]);c.factory("$safeApply",["$rootScope","$exceptionHandler",function(a,b){return function(c,d){if(c=c||a,-1===["$apply","$digest"].indexOf(c.$root.$$phase))return c.$apply(d);try{return c.$eval(d)}catch(e){b(e)}}}]),c.value("urlBase64Decode",function(a){var b=a.replace("-","+").replace("_","/");switch(b.length%4){case 0:break;case 2:b+="==";break;case 3:b+="=";break;default:throw"Illegal base64url string!"}return window.atob(b)});var d=angular.module("auth0-auth",["util","ngCookies"]),e={forbidden:"auth:FORBIDDEN",loginSuccess:"auth:LOGIN_SUCCESS",loginFailed:"auth:LOGIN_FAILED",logout:"auth:LOGOUT",redirectEnded:"auth:REDIRECT_ENDED"};d.constant("AUTH_EVENTS",e),a.prototype={},a.prototype.parseHash=function(a,b){this.auth0Lib.parseHash(a,b)},a.prototype._deserialize=function(){var a;try{a=this.$cookieStore.get("idToken")}catch(b){a=void 0}return a?(this.idToken=this.$cookieStore.get("idToken"),this.accessToken=this.$cookieStore.get("accessToken"),void(this.isAuthenticated=!0)):(this.isAuthenticated=!1,this.idToken=void 0,void(this.accessToken=void 0))},a.prototype._serialize=function(a,c,d){b(this.$cookieStore,"idToken",a),b(this.$cookieStore,"accessToken",c),b(this.$cookieStore,"state",d)},a.prototype.hasTokenExpired=function(a){if(!a)return!0;var b=a.split(".");if(3!==b.length)return!0;var c=this.urlBase64Decode(b[1]);if(!c)return!0;try{c=JSON.parse(c)}catch(d){return!0}if(!c.exp)return!0;var e=new Date(0);return e.setUTCSeconds(c.exp),isNaN(e)?!0:e.valueOf()>(new Date).valueOf()?!1:!0},a.prototype.getToken=function(a,b,c){b=b||{scope:"openid"};var d=this,e=d.$q.defer();c&&(this.delegatedTokens[a]=void 0);var f=this.delegatedTokens[a],g=this.hasTokenExpired(f);if(f&&!g)return e.resolve(f),e.promise;var h=this.auth0Lib;return h.getDelegationToken||(h=h.getClient()),h.getDelegationToken(a,this.idToken,b,this._wrapCallback(function(b,c){return b?e.reject(b):(d.delegatedTokens[a]=c.id_token,e.resolve(c.id_token))})),e.promise},a.prototype.signin=function(a){a=a||{};var b=function(a,b,d,f,g){return a?void c.$rootScope.$broadcast(e.loginFailed,a):(c._serialize(d,f,g),c._deserialize(),void c.getProfile(d).then(function(){c.$rootScope.$broadcast(e.loginSuccess,c.profile)}))},c=this;"undefined"!=typeof Auth0Widget&&c.auth0Lib instanceof Auth0Widget&&(b=null),c.auth0Lib.signin(a,b)},a.prototype.signout=function(){this._serialize(void 0,void 0,void 0),this._deserialize(),this.$rootScope.$broadcast(e.logout)},a.prototype._wrapCallback=function(a){var b=this;return function(){return b.$safeApply(void 0,a.apply(null,arguments))}},a.prototype.parseHash=function(a){return this.auth0Lib.parseHash(a)},a.prototype.getProfile=function(a){var b=this.$q.defer(),c=this,d=this._wrapCallback(function(a,d){return a?b.reject(a):(Object.keys(c.profile).forEach(function(a){delete c.profile[a]}),Object.keys(d).forEach(function(a){c.profile[a]=d[a]}),void b.resolve(c.profile))});return this.auth0Lib.getProfile(a,d),b.promise},a.prototype.signup=function(a){this.auth0Lib.signup(a)},a.prototype.reset=function(a){this.auth0Lib.reset(a)},d.provider("auth",["$provide",function(b){var c;this.init=function(a,c){var d;if(void 0===a.callbackOnLocationHash&&(a.callbackOnLocationHash=!0),c)d=new c(a);else if("undefined"!=typeof Auth0Widget)d=new Auth0Widget(a);else{if("undefined"==typeof Auth0)throw new Error("Auth0Widget or Auth0.js dependency not found");d=new Auth0(a)}b.value("auth0Lib",d)},this.$get=["$cookieStore","$rootScope","$safeApply","$q","$injector","urlBase64Decode",function(b,d,e,f,g,h){var i=g.get("auth0Lib");if(!i)throw new Error("auth0Lib dependency not found. Have you called authProvider.init?");return c||(c=new a(i,b,d,e,f,h)),c}]}]),d.factory("parseHash",["auth","$rootScope","$window",function(a,b,c){return function(){var d=a.parseHash(c.location.hash);d&&d.id_token?a.getProfile(d.id_token).then(function(){a._serialize(d.id_token,d.access_token,d.state),a._deserialize(),b.$broadcast(e.loginSuccess,a.profile)},function(c){a._deserialize(),b.$broadcast(e.loginFailed,c)}):(a._deserialize(),a.getProfile(a.idToken).finally(function(){b.$broadcast(e.redirectEnded)}))}}]);var f=angular.module("auth0",["auth0-auth"]);f.run(["parseHash",function(a){a()}]);var g=angular.module("authInterceptor",["auth0-auth"]);g.factory("authInterceptor",["auth","$rootScope","$q","AUTH_EVENTS",function(a,b,c,d){return{request:function(b){return b.headers=b.headers||{},a.idToken&&(b.headers.Authorization="Bearer "+a.idToken),b},responseError:function(a){return 401===a.status&&b.$broadcast(d.forbidden,a),a||c.when(a)}}}])}();